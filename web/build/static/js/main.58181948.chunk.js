(this.webpackJsonpweb=this.webpackJsonpweb||[]).push([[0],{42:function(e,n,t){e.exports=t(87)},47:function(e,n,t){},81:function(e,n){},87:function(e,n,t){"use strict";t.r(n);var r=t(0),c=t.n(r),a=t(37),o=t.n(a),u=(t(47),t(3)),i=t(4),s=t(1),l=t.n(s),d=t(5),f=t(12),p=t(38),b=t.n(p),m=t(13),v=t(14);function g(){var e=Object(m.a)(["\n\tdisplay: inline-block;\n\tposition: absolute;\n\ttop: 230px;\n\tleft: 0px;\n"]);return g=function(){return e},e}function h(){var e=Object(m.a)(["\n\twidth: 240px;\n\theight: 240px;\n\tbackground-color: black;\n"]);return h=function(){return e},e}function w(){var e=Object(m.a)(["\n\tposition: relative;\n\tdisplay: inline-block;\n\twidth: 240px;\n\theight: 270px;\n\tmargin: 5px;\n"]);return w=function(){return e},e}var O=v.a.div(w()),j=v.a.video(h()),x=v.a.p(g()),k=function(e){var n=e.email,t=e.stream,a=e.muted,o=Object(r.useRef)(null),u=Object(r.useState)(!1),i=Object(f.a)(u,2),s=i[0],l=i[1];return Object(r.useEffect)((function(){o.current&&(o.current.srcObject=t),a&&l(a)}),[t,a]),c.a.createElement(O,null,c.a.createElement(j,{ref:o,muted:s,autoPlay:!0}),c.a.createElement(x,null,n))},R={iceServers:[{urls:"stun:stun.l.google.com:19302"}]},D=function(){var e=Object(r.useRef)(),n=Object(r.useRef)({}),t=Object(r.useRef)(null),a=Object(r.useRef)(),o=Object(r.useState)([]),s=Object(f.a)(o,2),p=s[0],m=s[1],v=Object(r.useCallback)(Object(d.a)(l.a.mark((function n(){var r;return l.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,navigator.mediaDevices.getUserMedia({audio:!0,video:{width:240,height:240}});case 3:if(r=n.sent,a.current=r,t.current&&(t.current.srcObject=r),e.current){n.next=8;break}return n.abrupt("return");case 8:e.current.emit("join_room",{room:"1234",email:"sample@naver.com"}),n.next=14;break;case 11:n.prev=11,n.t0=n.catch(0),console.log("getUserMedia error: ".concat(n.t0));case 14:case"end":return n.stop()}}),n,null,[[0,11]])}))),[]),g=Object(r.useCallback)((function(n,t){try{var r=new RTCPeerConnection(R);return r.onicecandidate=function(t){e.current&&t.candidate&&(console.log("onicecandidate"),e.current.emit("candidate",{candidate:t.candidate,candidateSendID:e.current.id,candidateReceiveID:n}))},r.oniceconnectionstatechange=function(e){console.log(e)},r.ontrack=function(e){console.log("ontrack success"),m((function(r){return r.filter((function(e){return e.id!==n})).concat({id:n,email:t,stream:e.streams[0]})}))},a.current?(console.log("localstream add"),a.current.getTracks().forEach((function(e){a.current&&r.addTrack(e,a.current)}))):console.log("no local stream"),r}catch(c){return void console.error(c)}}),[]);return Object(r.useEffect)((function(){return e.current=b.a.connect("/"),v(),e.current.on("all_users",(function(t){t.forEach(function(){var t=Object(d.a)(l.a.mark((function t(r){var c,o;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a.current){t.next=2;break}return t.abrupt("return");case 2:if((c=g(r.id,r.email))&&e.current){t.next=5;break}return t.abrupt("return");case 5:return n.current=Object(i.a)(Object(i.a)({},n.current),{},Object(u.a)({},r.id,c)),t.prev=6,t.next=9,c.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});case 9:return o=t.sent,console.log("create offer success"),t.next=13,c.setLocalDescription(new RTCSessionDescription(o));case 13:e.current.emit("offer",{sdp:o,offerSendID:e.current.id,offerSendEmail:"offerSendSample@sample.com",offerReceiveID:r.id}),t.next=19;break;case 16:t.prev=16,t.t0=t.catch(6),console.error(t.t0);case 19:case"end":return t.stop()}}),t,null,[[6,16]])})));return function(e){return t.apply(this,arguments)}}())})),e.current.on("getOffer",function(){var t=Object(d.a)(l.a.mark((function t(r){var c,o,s,d,f;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(c=r.sdp,o=r.offerSendID,s=r.offerSendEmail,console.log("get offer"),a.current){t.next=4;break}return t.abrupt("return");case 4:if((d=g(o,s))&&e.current){t.next=7;break}return t.abrupt("return");case 7:return n.current=Object(i.a)(Object(i.a)({},n.current),{},Object(u.a)({},o,d)),t.prev=8,t.next=11,d.setRemoteDescription(new RTCSessionDescription(c));case 11:return console.log("answer set remote description success"),t.next=14,d.createAnswer({offerToReceiveVideo:!0,offerToReceiveAudio:!0});case 14:return f=t.sent,t.next=17,d.setLocalDescription(new RTCSessionDescription(f));case 17:e.current.emit("answer",{sdp:f,answerSendID:e.current.id,answerReceiveID:o}),t.next=23;break;case 20:t.prev=20,t.t0=t.catch(8),console.error(t.t0);case 23:case"end":return t.stop()}}),t,null,[[8,20]])})));return function(e){return t.apply(this,arguments)}}()),e.current.on("getAnswer",(function(e){var t=e.sdp,r=e.answerSendID;console.log("get answer");var c=n.current[r];c&&c.setRemoteDescription(new RTCSessionDescription(t))})),e.current.on("getCandidate",function(){var e=Object(d.a)(l.a.mark((function e(t){var r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("get candidate"),r=n.current[t.candidateSendID]){e.next=4;break}return e.abrupt("return");case 4:return e.next=6,r.addIceCandidate(new RTCIceCandidate(t.candidate));case 6:console.log("candidate add success");case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()),e.current.on("user_exit",(function(e){n.current[e.id]&&(n.current[e.id].close(),delete n.current[e.id],m((function(n){return n.filter((function(n){return n.id!==e.id}))})))})),function(){e.current&&e.current.disconnect(),p.forEach((function(e){n.current[e.id]&&(n.current[e.id].close(),delete n.current[e.id])}))}}),[g,v]),c.a.createElement("div",null,c.a.createElement("video",{style:{width:240,height:240,margin:5,backgroundColor:"black"},muted:!0,ref:t,autoPlay:!0}),p.map((function(e,n){return c.a.createElement(k,{key:n,email:e.email,stream:e.stream})})))};o.a.render(c.a.createElement(c.a.StrictMode,null,c.a.createElement(D,null)),document.getElementById("root"))}},[[42,1,2]]]);
//# sourceMappingURL=main.58181948.chunk.js.map